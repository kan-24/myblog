import{J as o,K as c,p as m}from"./index-D9tgDiJn.js";const n="https://api.example.com/api";function u(e){return e?{Authorization:`Bearer ${e}`}:{}}async function f(e,a=1,t=20){const s=await fetch(`${n}/posts/${e}/comments?page=${a}&size=${t}`);if(!s.ok){const r=await i(s);throw new Error(r)}return await s.json()}async function h(e,a,t){const s=await fetch(`${n}/posts/${e}/comments`,{method:"POST",headers:{"Content-Type":"application/json",...u(t)},body:JSON.stringify(a)});if(!s.ok){const r=await i(s);throw new Error(r)}return await s.json()}async function i(e){try{const a=await e.json();return typeof a=="object"&&a&&"message"in a?String(a.message):e.statusText||o.global.t("common.serverError")}catch{return e.statusText||o.global.t("common.serverError")}}const g=c("comments",{state:()=>({items:{},submitting:!1}),actions:{stateFor(e){return this.items[e]||(this.items[e]={data:[],page:1,hasMore:!0,loading:!1}),this.items[e]},async ensureLoaded(e,a=!1){const t=this.stateFor(e);if(!t.loading&&!(!a&&t.data.length&&!t.hasMore)&&(a&&(t.data=[],t.page=1,t.hasMore=!0),!!t.hasMore)){t.loading=!0;try{const s=await f(e,t.page,20);a?t.data=s:t.data=[...t.data,...s],s.length<20?t.hasMore=!1:t.page+=1}finally{t.loading=!1}}},async submit(e,a){const t=m();if(!t.token)throw new Error("LOGIN_REQUIRED");this.submitting=!0;try{const s=await h(e,a,t.token),r=this.stateFor(e);return r.data=[...r.data,s],s}finally{this.submitting=!1}}},getters:{listByPost:e=>a=>{var t;return((t=e.items[a])==null?void 0:t.data)??[]},hasMore:e=>a=>{var t;return((t=e.items[a])==null?void 0:t.hasMore)??!0},loading:e=>a=>{var t;return((t=e.items[a])==null?void 0:t.loading)??!1}}});export{g as u};
