import{r as _,c,a as i,o as d,d as s,b as D,C as L,v as I,F as S,g as A,m as V,z as M,t as a,L as P,M as z,N as K,O as B,q as F,u as T,n as j,e as r,k as x,l as q,J as E}from"./index-BLJpVeXD.js";import{u as O}from"./posts-DfVChRhQ.js";import{u as J}from"./comments-BPhU_vLp.js";const R={class:"mb-3 flex flex-wrap items-center gap-3"},U={class:"overflow-x-auto rounded-lg border border-slate-200 dark:border-slate-700"},G={class:"min-w-full divide-y divide-slate-200 text-sm dark:divide-slate-700"},H={class:"bg-slate-100 dark:bg-slate-900"},Q=["onClick"],W={key:0},X={class:"divide-y divide-slate-200 dark:divide-slate-800"},Y={class:"mt-4 flex items-center justify-between text-xs text-slate-500"},Z={class:"flex items-center gap-2"},ee=["disabled"],se=["disabled"],w={__name:"AdminTable",props:{rows:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},pageSize:{type:Number,default:10},rowKey:{type:Function,required:!0}},setup(k){const b=k,p=_(""),l=_(""),u=_("asc"),m=_(1),e=c(()=>b.pageSize??10),v=c(()=>p.value?b.rows.filter(o=>Object.values(o).some(n=>String(n).toLowerCase().includes(p.value.toLowerCase()))):b.rows),f=c(()=>l.value?[...v.value].sort((o,n)=>{const t=u.value==="asc"?1:-1;return o[l.value]>n[l.value]?t:o[l.value]<n[l.value]?-t:0}):v.value),g=c(()=>Math.max(1,Math.ceil(f.value.length/e.value))),$=c(()=>{const o=(m.value-1)*e.value;return f.value.slice(o,o+e.value)}),C=o=>{l.value===o?u.value=u.value==="asc"?"desc":"asc":(l.value=o,u.value="asc")};return(o,n)=>(d(),i("div",null,[s("div",R,[D(s("input",{"onUpdate:modelValue":n[0]||(n[0]=t=>p.value=t),type:"search",placeholder:"搜索...",class:"rounded border border-slate-200 px-3 py-2 text-sm dark:border-slate-700 dark:bg-slate-800"},null,512),[[I,p.value]]),L(o.$slots,"controls")]),s("div",U,[s("table",G,[s("thead",H,[s("tr",null,[(d(!0),i(S,null,A(k.columns,t=>(d(),i("th",{key:t.key,class:"px-4 py-2 text-left font-medium text-slate-600 dark:text-slate-300"},[s("button",{class:"flex items-center gap-1",onClick:h=>C(t.key)},[V(a(t.label)+" ",1),l.value===t.key?(d(),i("span",W,a(u.value==="asc"?"▲":"▼"),1)):M("",!0)],8,Q)]))),128))])]),s("tbody",X,[(d(!0),i(S,null,A($.value,t=>(d(),i("tr",{key:k.rowKey(t),class:"bg-white hover:bg-slate-50 dark:bg-slate-900 dark:hover:bg-slate-950"},[(d(!0),i(S,null,A(k.columns,h=>(d(),i("td",{key:h.key,class:"px-4 py-2"},[L(o.$slots,h.key,{row:t},()=>[V(a(t[h.key]),1)])]))),128))]))),128))])])]),s("div",Y,[s("span",null,"共 "+a(v.value.length)+" 条",1),s("div",Z,[s("button",{class:"rounded px-2 py-1 hover:bg-slate-100 dark:hover:bg-slate-800",disabled:m.value===1,onClick:n[1]||(n[1]=t=>m.value--)}," 上一页 ",8,ee),s("span",null,"第 "+a(m.value)+" / "+a(g.value)+" 页",1),s("button",{class:"rounded px-2 py-1 hover:bg-slate-100 dark:hover:bg-slate-800",disabled:m.value===g.value,onClick:n[2]||(n[2]=t=>m.value++)}," 下一页 ",8,se)])])]))}},te=P("visitors",{state:()=>({visitors:z("visitors",[]),loaded:!1}),actions:{async ensureLoaded(){this.loaded||(this.visitors.length||(this.visitors=await K(),B("visitors",this.visitors)),this.loaded=!0)}}}),oe={class:"mx-auto max-w-6xl space-y-10"},ae={class:"text-2xl font-bold"},le={class:"text-sm text-slate-500"},ne={class:"space-y-6"},re={class:"mb-3 text-lg font-semibold"},ie={class:"flex gap-2"},de=["onClick"],ce=["onClick"],ue={class:"mb-3 text-lg font-semibold"},me={class:"mb-3 text-lg font-semibold"},ve={class:"mb-3 text-lg font-semibold"},he={__name:"AdminDashboardView",setup(k){const b=O(),p=J(),l=F(),u=te(),m=E(),{t:e}=T(),v=t=>t.id,f=c(()=>[{key:"title",label:e("admin.posts.columns.title")},{key:"category",label:e("admin.posts.columns.category")},{key:"publishedAt",label:e("admin.posts.columns.publishedAt")},{key:"views",label:e("admin.posts.columns.views")},{key:"likes",label:e("admin.posts.columns.likes")},{key:"actions",label:e("admin.posts.columns.actions")}]),g=c(()=>[{key:"postId",label:e("admin.comments.columns.postId")},{key:"content",label:e("admin.comments.columns.content")},{key:"authorId",label:e("admin.comments.columns.author")},{key:"createdAt",label:e("admin.comments.columns.createdAt")}]),$=c(()=>[{key:"name",label:e("admin.users.columns.name")},{key:"email",label:e("admin.users.columns.email")},{key:"role",label:e("admin.users.columns.role")},{key:"language",label:e("admin.users.columns.language")}]),C=c(()=>[{key:"location",label:e("admin.visitors.columns.location")},{key:"userAgent",label:e("admin.visitors.columns.userAgent")},{key:"referrer",label:e("admin.visitors.columns.referrer")},{key:"enteredAt",label:e("admin.visitors.columns.enteredAt")}]),o=t=>{m.push({name:"editor",params:{id:t}})},n=async t=>{if(window.confirm(e("admin.alerts.confirmDelete")))try{await b.remove(t),window.alert(e("admin.alerts.deleteSuccess"))}catch(y){console.error(y),window.alert((y==null?void 0:y.message)??e("admin.alerts.deleteError"))}};return j(async()=>{var t;await Promise.all([b.ensureLoaded(),p.ensureLoaded(),(t=l.ensureLoaded)==null?void 0:t.call(l),u.ensureLoaded()])}),(t,h)=>(d(),i("section",oe,[s("header",null,[s("h1",ae,a(r(e)("admin.title")),1),s("p",le,a(r(e)("admin.description")),1)]),s("div",ne,[s("div",null,[s("h2",re,a(r(e)("admin.sections.posts")),1),x(w,{rows:r(b).posts,columns:f.value,"row-key":v},{actions:q(({row:y})=>[s("div",ie,[s("button",{class:"text-xs text-brand",onClick:N=>o(y.id)},a(r(e)("admin.posts.actions.edit")),9,de),s("button",{class:"text-xs text-red-500",onClick:N=>n(y.id)},a(r(e)("admin.posts.actions.delete")),9,ce)])]),_:1},8,["rows","columns"])]),s("div",null,[s("h2",ue,a(r(e)("admin.sections.comments")),1),x(w,{rows:r(p).comments,columns:g.value,"row-key":v},null,8,["rows","columns"])]),s("div",null,[s("h2",me,a(r(e)("admin.sections.users")),1),x(w,{rows:r(l).users,columns:$.value,"row-key":v},null,8,["rows","columns"])]),s("div",null,[s("h2",ve,a(r(e)("admin.sections.visitors")),1),x(w,{rows:r(u).visitors,columns:C.value,"row-key":v},null,8,["rows","columns"])])])]))}};export{he as default};
