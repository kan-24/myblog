import{Q as p,L as u,M as h,O as i}from"./index-BLJpVeXD.js";const r="http://localhost:8080/api";async function g(s){const t=await fetch(`${r}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){const e=await n(t);throw new Error(e)}return await t.json()}async function y(){const s=await fetch(`${r}/posts`);if(!s.ok){const t=await n(s);throw new Error(t)}return await s.json()}async function d(s,t){const e=await fetch(`${r}/posts/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const o=await n(e);throw new Error(o)}return await e.json()}async function f(s,t){const e=await fetch(`${r}/posts/${s}/likes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({liked:t})});if(!e.ok){const o=await n(e);throw new Error(o)}return await e.json()}async function k(s){const t=await fetch(`${r}/posts/${s}`,{method:"DELETE"});if(!t.ok){const e=await n(t);throw new Error(e)}}async function n(s){try{const t=await s.json();return typeof t=="object"&&t&&"message"in t?String(t.message):s.statusText||p.global.t("common.serverError")}catch{return s.statusText||p.global.t("common.serverError")}}const v=u("posts",{state:()=>({posts:h("posts",[]),loaded:!1,favorites:h("favorites",{}),likes:h("likes",{})}),getters:{categories(s){return[...new Set(s.posts.map(t=>t.category))]},tags(s){return[...new Set(s.posts.flatMap(t=>t.tags))]}},actions:{async ensureLoaded(){this.loaded||(this.posts=await y(),i("posts",this.posts),this.loaded=!0)},async create(s){const t=await g(s);return this.posts.unshift(t),i("posts",this.posts),t},async update(s,t){const e=await d(s,t);return this.posts=this.posts.map(o=>o.id===s?e:o),i("posts",this.posts),e},async remove(s){const t=[...this.posts];this.posts=this.posts.filter(e=>e.id!==s),i("posts",this.posts);try{await k(s)}catch(e){throw this.posts=t,i("posts",this.posts),e}},toggleFavorite(s){this.favorites[s]=!this.favorites[s],i("favorites",this.favorites);const t=this.posts.find(e=>e.id===s);t&&(t.favorites+=this.favorites[s]?1:-1)},async toggleLike(s){const t=!this.likes[s],e=t?1:-1;this.likes[s]=t,i("likes",this.likes);const o=this.posts.findIndex(a=>a.id===s);if(o===-1){try{await f(s,t)}catch(a){throw this.likes[s]=!t,i("likes",this.likes),a}return}const c=this.posts[o],l=c.likes??0,w={...c,likes:Math.max(0,l+e)};this.posts.splice(o,1,w),i("posts",this.posts);try{const a=await f(s,t);this.posts.splice(o,1,a),i("posts",this.posts)}catch(a){throw this.posts.splice(o,1,c),this.likes[s]=!t,i("likes",this.likes),a}}}});export{v as u};
