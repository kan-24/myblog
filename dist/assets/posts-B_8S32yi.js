import{R as h,O as u,P as p,Q as i}from"./index-B5S0Oh91.js";const r="http://localhost:8080/api";async function d(t){const s=await fetch(`${r}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const e=await n(s);throw new Error(e)}return await s.json()}async function y(){const t=await fetch(`${r}/posts`);if(!t.ok){const s=await n(t);throw new Error(s)}return await t.json()}async function g(t,s){const e=await fetch(`${r}/posts/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!e.ok){const o=await n(e);throw new Error(o)}return await e.json()}async function l(t,s){const e=await fetch(`${r}/posts/${t}/likes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({liked:s})});if(!e.ok){const o=await n(e);throw new Error(o)}return await e.json()}async function k(t){const s=await fetch(`${r}/posts/${t}`,{method:"DELETE"});if(!s.ok){const e=await n(s);throw new Error(e)}}async function n(t){try{const s=await t.json();return typeof s=="object"&&s&&"message"in s?String(s.message):t.statusText||h.global.t("common.serverError")}catch{return t.statusText||h.global.t("common.serverError")}}const P=u("posts",{state:()=>({posts:p("posts",[]),loaded:!1,favorites:p("favorites",{}),likes:p("likes",{})}),getters:{categories(t){return[...new Set(t.posts.map(s=>s.category))]},tags(t){return[...new Set(t.posts.flatMap(s=>s.tags))]}},actions:{async ensureLoaded(){this.loaded||(this.posts=await y(),i("posts",this.posts),this.loaded=!0)},async create(t){const s=await d(t);return this.posts.unshift(s),i("posts",this.posts),s},async update(t,s){const e=await g(t,s);return this.posts=this.posts.map(o=>o.id===t?e:o),i("posts",this.posts),e},async remove(t){const s=[...this.posts];this.posts=this.posts.filter(e=>e.id!==t),i("posts",this.posts);try{await k(t)}catch(e){throw this.posts=s,i("posts",this.posts),e}},async toggleLike(t){const s=!this.likes[t],e=s?1:-1;this.likes[t]=s,i("likes",this.likes);const o=this.posts.findIndex(a=>a.id===t);if(o===-1){try{await l(t,s)}catch(a){throw this.likes[t]=!s,i("likes",this.likes),a}return}const c=this.posts[o],w=c.likes??0,f={...c,likes:Math.max(0,w+e)};this.posts.splice(o,1,f),i("posts",this.posts);try{const a=await l(t,s);this.posts.splice(o,1,a),i("posts",this.posts)}catch(a){throw this.posts.splice(o,1,c),this.likes[t]=!s,i("likes",this.likes),a}}}});export{P as u};
