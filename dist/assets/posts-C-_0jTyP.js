import{K as a,L as o,N as i,P as r}from"./index-pPjq6uOp.js";const n="http://localhost:8080/api";async function h(s){const t=await fetch(`${n}/posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){const e=await p(t);throw new Error(e)}return await t.json()}async function p(s){try{const t=await s.json();return typeof t=="object"&&t&&"message"in t?String(t.message):s.statusText||"服务器返回错误"}catch{return s.statusText||"服务器返回错误"}}const f=a("posts",{state:()=>({posts:o("posts",[]),loaded:!1,favorites:o("favorites",{}),likes:o("likes",{})}),getters:{categories(s){return[...new Set(s.posts.map(t=>t.category))]},tags(s){return[...new Set(s.posts.flatMap(t=>t.tags))]}},actions:{async ensureLoaded(){this.loaded||(this.posts.length||(this.posts=await r(),i("posts",this.posts)),this.loaded=!0)},async create(s){const t=await h(s);return this.posts.unshift(t),i("posts",this.posts),t},async update(s,t){this.posts=this.posts.map(e=>e.id===s?{...e,...t,updatedAt:new Date().toISOString()}:e),i("posts",this.posts)},async remove(s){this.posts=this.posts.filter(t=>t.id!==s),i("posts",this.posts)},toggleFavorite(s){this.favorites[s]=!this.favorites[s],i("favorites",this.favorites);const t=this.posts.find(e=>e.id===s);t&&(t.favorites+=this.favorites[s]?1:-1)},toggleLike(s){this.likes[s]=!this.likes[s],i("likes",this.likes);const t=this.posts.find(e=>e.id===s);t&&(t.likes+=this.likes[s]?1:-1)}}});export{f as u};
